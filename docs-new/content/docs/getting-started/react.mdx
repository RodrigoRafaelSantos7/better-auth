---
title: React (SPA)
description: Convex + Better Auth with React (Single Page App)
---

## Prerequisites

<div className="fd-steps">
  <include>../../includes/prerequisites.mdx</include>
</div>

## Installation

<div className="fd-steps">

{" "}
<include>../../includes/installation.mdx</include>

  <div className="fd-step">
    ### Set environment variables

    Generate a secret for encryption and generating hashes. Use the command below if you have openssl installed, or use the button to generate a random value instead. Or generate your own however you like.

    ```shell
    npx convex env set BETTER_AUTH_SECRET=$(openssl rand -base64 32)
    ```

    Add your site URL to your Convex deployment.

    ```shell
    npx convex env set SITE_URL http://localhost:5173
    ```

    Add environment variables to the `.env.local` file created by `npx convex dev`. It will be picked up by your framework dev server.

    ```shell title=".env.local" tab="Cloud"
    # Deployment used by \`npx convex dev\`
    CONVEX_DEPLOYMENT=dev:adjective-animal-123 # team: team-name, project: project-name

    VITE_CONVEX_URL=https://adjective-animal-123.convex.cloud

    # Same as VITE_CONVEX_URL but ends in .site // [!code ++]
    VITE_CONVEX_SITE_URL=https://adjective-animal-123.convex.site # [!code ++]

    # Your local site URL // [!code ++]
    SITE_URL=http://localhost:5173 # [!code ++]
    ```

    ```shell title=".env.local" tab="Self hosted"
    # Deployment used by \`npx convex dev\`
    CONVEX_DEPLOYMENT=dev:adjective-animal-123 # team: team-name, project: project-name

    VITE_CONVEX_URL=http://127.0.0.1:3210

    # Same as VITE_CONVEX_URL but ends in .site // [!code ++]
    VITE_CONVEX_SITE_URL=http://127.0.0.1:3211 # [!code ++]

    # Your local site URL // [!code ++]
    SITE_URL=http://localhost:5173 # [!code ++]
    ```

  </div>

  <div className="fd-step">
    ### Create a Better Auth instance

    Create a Better Auth instance and initialize the component.

    <Callout>Some Typescript errors will show until you save the file.</Callout>

    ```ts title="convex/auth.ts"
    import { CreateAdapter, createClient, RunCtx } from "@convex-dev/better-auth";
    import { components } from "./_generated/api";
    import { query } from "./_generated/server";
    import { convex, crossDomain } from "@convex-dev/better-auth/plugins";
    import { betterAuth } from "better-auth";

    const siteUrl = process.env.SITE_URL!;

    export const createAuth = (ctx: RunCtx, createAdapter: CreateAdapter) => {
      return betterAuth({
        trustedOrigins: [siteUrl],
        database: createAdapter(ctx),
        // Configure simple, non-verified email/password to get started
        emailAndPassword: {
          enabled: true,
          requireEmailVerification: false,
        },
        plugins: [
          // The cross domain plugin is required for client side frameworks
          crossDomain({ siteUrl }),
          // The Convex plugin is required for Convex compatibility
          convex(),
        ],
      });
    };

    // The component client has methods needed for integrating Convex with Better Auth,
    // as well as helper methods for general use.
    export const betterAuthComponent = createClient(
      components.betterAuth.adapter,
      createAuth
    );

    // Example function for getting the current user
    // Feel free to edit, omit, etc.
    export const getCurrentUser = query({
      args: {},
      handler: async (ctx) => {
        return betterAuthComponent.getAuthUser(ctx);
      },
    });
    ```

  </div>

  <div className="fd-step">
    ### Create a Better Auth client instance

    Create a Better Auth client instance for interacting with the Better Auth server from your client.

    ```ts title="src/lib/auth-client.ts"
    import { createAuthClient } from "better-auth/react";
    import {
      convexClient,
      crossDomainClient,
    } from "@convex-dev/better-auth/client/plugins";

    export const authClient = createAuthClient({
      baseURL: import.meta.env.VITE_CONVEX_SITE_URL,
      plugins: [convexClient(), crossDomainClient()],
    });
    ```

  </div>

  <div className="fd-step">
    ### Mount handlers

    Register Better Auth route handlers on your Convex deployment.

    ```ts title="convex/http.ts"
    import { httpRouter } from "convex/server";
    import { betterAuthComponent } from "./auth";

    const http = httpRouter();

    // CORS handling is required for client side frameworks
    betterAuthComponent.registerRoutes(http, { cors: true });

    export default http;
    ```

  </div>

  <div className="fd-step">
    ### Set up Convex client provider

    Wrap your app with the `ConvexBetterAuthProvider` component.

    ```ts title="src/main.tsx"
    import React from "react";
    import ReactDOM from "react-dom/client";
    import App from "./App";
    import "./index.css";
    import { ConvexReactClient } from "convex/react";
    import { ConvexBetterAuthProvider } from "@convex-dev/better-auth/react"; // [!code ++]
    import { authClient } from "@/lib/auth-client"; // [!code ++]

    const convex = new ConvexReactClient(import.meta.env.VITE_CONVEX_URL as string, {
      // Optionally pause queries until the user is authenticated // [!code ++]
      expectAuth: true, // [!code ++]
    });

    ReactDOM.createRoot(document.getElementById("root")!).render(
      <React.StrictMode>
        <ConvexBetterAuthProvider client={convex} authClient={authClient}> // [!code ++]
          <App />
        </ConvexBetterAuthProvider> // [!code ++]
      </React.StrictMode>
    );
    ```

  </div>
</div>

### You're done!

You're now ready to start using Better Auth with Convex.
